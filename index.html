<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>제15회 SNUPOOL배 대학부 수영대회 이벤트게임 · 4:4 랜덤 판다리기</title>
  <meta name="description" content="참가자 명단을 넣으면 팀당 4명씩, 총 16명을 랜덤으로 추첨하여 물개/수달/돌고래/카피바라 팀으로 배정합니다. 모든 처리는 브라우저에서만 이뤄집니다." />
  <style>
    :root{
      --bg:#0b0b10; --panel:#15151d; --muted:#9aa1af; --text:#f2f4f8; --brand:#60a5fa; --accent:#22d3ee;
      --ok:#34d399; --warn:#fbbf24; --err:#f87171; --ring:rgba(96,165,250,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; background:linear-gradient(180deg,#0b0b10,#0f1016 40%,#0b0b10); color:var(--text); font-size:clamp(18px,1.6vw,22px)}
    .wrap{max-width:1200px; margin:0 auto; padding:32px 22px 90px}
    header h1{margin:.2rem 0 0; font-size:clamp(2.4rem,5.2vw,3.6rem); letter-spacing:.2px}
    header p{margin:.25rem 0 0; color:var(--muted); font-size:clamp(1rem,1.8vw,1.3rem)}
    header .badge{display:inline-flex; gap:.5rem; align-items:center; margin-top:.8rem; padding:.35rem .8rem; border:1px solid #273045; background:#0f1423; border-radius:999px; font-size:clamp(1rem,1.6vw,1.2rem); color:#c9d5ff}

    .grid{display:grid; gap:22px; grid-template-columns:1.1fr .9fr}
    @media(max-width:1024px){ .grid{grid-template-columns:1fr} }

    .card{background:linear-gradient(180deg,#13141c,#0f1016); border:1px solid #222536; border-radius:22px; box-shadow:0 6px 20px rgba(0,0,0,.35); overflow:hidden}
    .card .head{display:flex; align-items:center; justify-content:space-between; padding:18px 20px; border-bottom:1px solid #1e2232; background:radial-gradient(1200px 300px at -50% -100%, rgba(96,165,250,.12), transparent 50%) }
    .card .head h3{margin:0; font-weight:800; font-size:clamp(1.4rem,2.4vw,1.8rem)}
    .card .body{padding:20px}

    textarea{width:100%; min-height:280px; resize:vertical; padding:16px 16px 40px; border-radius:16px; border:1px solid #262b3d; outline:none; background:#0e111a; color:var(--text); line-height:1.6; font-size:clamp(1.2rem,2vw,1.4rem)}
    textarea:focus{border-color:#2d6eea; box-shadow:0 0 0 6px var(--ring)}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
    .hint{font-size:clamp(1rem,1.6vw,1.2rem); color:var(--muted)}

    .btn{appearance:none; border:1px solid #273045; background:linear-gradient(180deg,#1b2132,#111522); color:#e8eefc; padding:14px 18px; border-radius:14px; cursor:pointer; font-weight:800; transition:.2s transform,.2s opacity,.2s border-color; font-size:clamp(1.1rem,1.8vw,1.3rem)}
    .btn:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
    .btn:hover{transform:translateY(-1px); border-color:#334063}
    .btn[disabled]{opacity:.5; cursor:not-allowed}
    .btn.primary{border-color:#3b5ccc; background:linear-gradient(180deg,#3056c7,#2043a8)}
    .btn.ghost{background:transparent}
    .btn.success{background:linear-gradient(180deg,#16a34a,#15803d); border-color:#1a6b3d}

    .opt{display:flex; gap:12px; align-items:center}
    .opt input[type="text"]{height:44px; padding:0 12px; border-radius:12px; border:1px solid #262b3d; background:#0e111a; color:var(--text); font-size:clamp(1.1rem,1.6vw,1.2rem)}

    .teams{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
    @media(max-width:900px){ .teams{grid-template-columns:1fr} }
    .team{border:1px solid #24273a; border-radius:18px; background:linear-gradient(180deg,#141721,#101320)}
    .team .th{display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid #202335}
    .team .th h4{margin:0; font-size:clamp(1.6rem,2.8vw,2.2rem)}
    .team .th .emoji{font-size:clamp(1.6rem,2.8vw,2.2rem)}
    .team ol{margin:0; padding:16px 24px 22px 34px}
    .team ol li{margin:.4rem 0; padding:.18rem 0; font-size:clamp(1.8rem,3.4vw,2.6rem); font-weight:900; letter-spacing:.2px}

    .muted{color:var(--muted)}
    .stat{display:flex; gap:12px; flex-wrap:wrap}
    .pill{border:1px solid #273045; border-radius:999px; padding:.35rem .8rem; font-size:clamp(1rem,1.6vw,1.2rem); color:#cbd5e1}

    .footer{margin-top:18px; display:flex; gap:12px; flex-wrap:wrap}

    .alert{margin-top:12px; padding:12px 14px; border:1px solid #3a2a2a; background:#1a1010; color:#ffd1d1; border-radius:14px; font-size:clamp(1rem,1.6vw,1.2rem)}

    .confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden}
    .confetti span{position:absolute; top:-10px; font-size:18px; animation:drop 2.2s linear forwards; opacity:.95}
    @keyframes drop{to{transform:translateY(105vh) rotate(540deg); opacity:.9}}

    .small{font-size:clamp(1rem,1.6vw,1.2rem)}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; border:1px solid #2a2f45; background:#101428; padding:.12rem .5rem; border-radius:6px}

    .ghostline{border-top:1px dashed #2a2f45; margin:14px 0}
  </style>
</head>
<body>
  <div class="confetti" id="confetti" aria-hidden="true"></div>
  <div class="wrap">
    <header>
      <div class="badge">제15회 SNUPOOL배 대학부 수영대회 · 이벤트 게임</div>
      <h1>4:4 랜덤 판다리기</h1>
      <p class="small">참가자 텍스트를 붙여넣고 <span class="kbd">추첨</span>을 누르면 물개/수달/돌고래/카피바라 팀으로 4명씩, 총 16명을 자동 배정합니다. 모든 처리는 브라우저에서만 이뤄집니다.</p>
    </header>

    <div class="grid" role="main">
      <section class="card" aria-labelledby="input-head">
        <div class="head"><h3 id="input-head">참가자 입력</h3>
          <div class="row">
            <button class="btn ghost small" id="btnSample" type="button">예시 불러오기</button>
          </div>
        </div>
        <div class="body">
          <label for="names" class="hint">쉼표(,) 또는 줄바꿈으로 구분 · 공백/중복 자동 정리</label>
          <textarea id="names" placeholder="예) 홍길동, 김영희, 이철수, ..."></textarea>
          <div class="ghostline"></div>
          <div class="row" style="justify-content:space-between">
            <div class="stat">
              <span class="pill" id="statTotal">총 입력 0명</span>
              <span class="pill" id="statUnique">중복 제거 후 0명</span>
              <span class="pill" id="statDup" title="중복으로 제거된 수">중복 0명</span>
            </div>
            <div class="opt">
              <label class="small" for="seed">시드(선택):</label>
              <input type="text" id="seed" placeholder="같은 시드 = 같은 결과" />
              <label class="small" style="display:flex; gap:6px; align-items:center">
                <input type="checkbox" id="dedupe" checked /> 중복 제거
              </label>
            </div>
          </div>
          <div class="footer">
            <button class="btn primary" id="btnDraw" type="button">🎲 랜덤 추첨 (16명 선발)</button>
            <button class="btn" id="btnShuffle" type="button">🔁 다시 섞기</button>
            <button class="btn ghost" id="btnClear" type="button">🧹 초기화</button>
          </div>
          <div id="alert" class="alert" style="display:none"></div>
        </div>
      </section>

      <section class="card" aria-labelledby="result-head">
        <div class="head"><h3 id="result-head">결과</h3>
          <div class="row">
            <button class="btn small" id="btnCopy" type="button">📋 결과 복사</button>
            <button class="btn small" id="btnCSV" type="button">⬇️ CSV 다운로드</button>
          </div>
        </div>
        <div class="body">
          <div class="teams" id="teams"></div>
          <div id="benchWrap" style="margin-top:10px; display:none">
            <div class="ghostline"></div>
            <p class="muted small" id="benchTitle">미선발 명단 (0명)</p>
            <div id="bench" class="small"></div>
          </div>
        </div>
      </section>
    </div>

    <footer style="margin-top:22px; color:var(--muted)" class="small">
      팁: <span class="kbd">Cmd/Ctrl + Enter</span> 로 즉시 추첨 · 입력 내용은 로컬에 자동 저장됩니다.
    </footer>
  </div>

<script>
(function(){
  const $ = sel => document.querySelector(sel);
  const namesEl = $('#names');
  const dedupeEl = $('#dedupe');
  const seedEl = $('#seed');
  const alertEl = $('#alert');
  const teamsEl = $('#teams');
  const benchEl = $('#bench');
  const benchWrapEl = $('#benchWrap');
  const statTotal = $('#statTotal');
  const statUnique = $('#statUnique');
  const statDup = $('#statDup');
  const TEAM_INFO = [
    { key:'물개', emoji:'🦭' },
    { key:'수달', emoji:'🦦' },
    { key:'돌고래', emoji:'🐬' },
    { key:'카피바라', emoji:'🐹' }, // 카피바라 이모지 부재로 대체
  ];

  // --- LocalStorage hydration ---
  const LS_KEY = 'snupool_random_pandarigi_v1';
  try{ const saved = JSON.parse(localStorage.getItem(LS_KEY)||'null'); if(saved && saved.text){ namesEl.value = saved.text; seedEl.value = saved.seed||''; dedupeEl.checked = !!saved.dedupe; } }catch(e){}

  // --- Utility: seeded RNG (xmur3 + mulberry32) ---
  function xmur3(str){ let h=1779033703 ^ str.length; for(let i=0;i<str.length;i++){ h = Math.imul(h ^ str.charCodeAt(i), 3432918353); h = (h<<13) | (h>>>19); } return function(){ h = Math.imul(h ^ (h>>>16), 2246822507); h = Math.imul(h ^ (h>>>13), 3266489909); return (h ^= h>>>16)>>>0; } }
  function mulberry32(a){ return function(){ let t = a += 0x6D2B79F5; t = Math.imul(t ^ (t>>>15), t | 1); t ^= t + Math.imul(t ^ (t>>>7), t | 61); return ((t ^ (t>>>14)) >>> 0) / 4294967296; } }
  function rngFromSeed(seed){ if(!seed) return Math.random; const seedFn = xmur3(String(seed)); const r = mulberry32(seedFn()); return r; }

  // --- Parse input ---
  function parseNames(){
    const raw = namesEl.value.replace(/
/g, ',');
    const arr = raw.split(',').map(s=>s.trim()).filter(Boolean);
    const total = arr.length;
    let unique = arr;
    let dups = 0;
    if(dedupeEl.checked){
      const seen = new Set();
      unique = [];
      for(const n of arr){ if(!seen.has(n)){ unique.push(n); seen.add(n); } else { dups++; } }
    }
    statTotal.textContent = `총 입력 ${total}명`;
    statUnique.textContent = `중복 제거 후 ${unique.length}명`;
    statDup.textContent = `중복 ${dups}명`;
    return unique;
  }

  function saveLS(){
    try{ localStorage.setItem(LS_KEY, JSON.stringify({ text:namesEl.value, seed:seedEl.value, dedupe:dedupeEl.checked })); }catch(e){}
  }

  namesEl.addEventListener('input', ()=>{ parseNames(); saveLS(); });
  dedupeEl.addEventListener('change', ()=>{ parseNames(); saveLS(); });
  seedEl.addEventListener('input', saveLS);

  // --- Shuffle & pick ---
  function shuffleInPlace(a, rnd){ for(let i=a.length-1;i>0;i--){ const j = Math.floor(rnd()* (i+1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

  function draw(){
    clearAlert();
    const list = parseNames();
    if(list.length < 16){
      showAlert(`참가자가 ${list.length}명입니다. 최소 16명이 필요합니다.`, 'err');
      renderTeams([]); renderBench([]); return;
    }
    const rnd = rngFromSeed(seedEl.value.trim());
    const pool = list.slice();
    shuffleInPlace(pool, rnd);
    const selected = pool.slice(0, 16);
    const bench = pool.slice(16);
    renderTeams(selected);
    renderBench(bench);
    burstConfetti();
  }

  function reshuffle(){
    const hasResult = teamsEl.children.length > 0;
    if(!hasResult){ draw(); return; }
    const current = collectCurrentMembers();
    if(current.length !== 16){ draw(); return; }
    const rnd = rngFromSeed(seedEl.value.trim());
    shuffleInPlace(current, rnd);
    renderTeams(current);
    burstConfetti();
  }

  function collectCurrentMembers(){
    const li = teamsEl.querySelectorAll('li');
    return Array.from(li).map(x=>x.textContent.trim()).filter(Boolean);
  }

  function renderTeams(selected){
    teamsEl.innerHTML = '';
    if(selected.length === 0){ return; }
    const teams = [ selected.slice(0,4), selected.slice(4,8), selected.slice(8,12), selected.slice(12,16) ];
    teams.forEach((members, idx)=>{
      const info = TEAM_INFO[idx];
      const box = document.createElement('div'); box.className = 'team';
      const head = document.createElement('div'); head.className = 'th';
      head.innerHTML = `<h4><span class="emoji">${info.emoji}</span> ${info.key} 팀</h4><span class="muted small">${members.length}명</span>`;
      const list = document.createElement('ol');
      members.forEach(n=>{ const li = document.createElement('li'); li.textContent = n; list.appendChild(li); });
      box.appendChild(head); box.appendChild(list); teamsEl.appendChild(box);
    });
  }

  function renderBench(bench){
    if(!bench || bench.length===0){ benchWrapEl.style.display='none'; benchEl.textContent=''; return; }
    benchWrapEl.style.display='block';
    $('#benchTitle').textContent = `미선발 명단 (${bench.length}명)`;
    benchEl.textContent = bench.join(', ');
  }

  function toText(){
    if(teamsEl.children.length===0) return '';
    let out = `제15회 SNUPOOL배 이벤트게임 - 4:4 랜덤 판다리기
`;
    for(let i=0;i<4;i++){
      const info = TEAM_INFO[i];
      const items = teamsEl.children[i].querySelectorAll('li');
      const names = Array.from(items).map(li=>li.textContent.trim());
      out += `
[${info.emoji} ${info.key}] ${names.join(', ')}`;
    }
    if(benchEl.textContent.trim()) out += `

(미선발) ${benchEl.textContent.trim()}`;
    return out;
  }

  function toCSV(){
    const rows = [["Team","Member"]];
    for(let i=0;i<4;i++){
      const info = TEAM_INFO[i];
      const items = teamsEl.children[i]?.querySelectorAll('li') || [];
      Array.from(items).forEach(li=> rows.push([info.key, li.textContent.trim()]));
    }
    return rows.map(r=> r.map(s=> '"'+String(s).replace(/"/g,'""')+'"').join(',')).join('
');
  }

  function copyResult(){
    const txt = toText();
    if(!txt){ showAlert('복사할 결과가 없습니다. 먼저 추첨을 진행하세요.','warn'); return; }
    navigator.clipboard.writeText(txt).then(()=>{ showAlert('결과를 클립보드에 복사했어요. 원하는 곳에 붙여넣기 하세요.','ok'); });
  }

  function downloadCSV(){
    if(teamsEl.children.length===0){ showAlert('다운로드할 결과가 없습니다. 먼저 추첨을 진행하세요.','warn'); return; }
    const blob = new Blob(["﻿" + toCSV()], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'snupool_random_teams.csv';
    document.body.appendChild(a); a.click(); a.remove();
  }

  function showAlert(msg, type='warn'){
    alertEl.textContent = msg; alertEl.style.display='block';
    alertEl.style.borderColor = type==='ok'? '#1e3b2d' : (type==='err'? '#3a2a2a' : '#3a2f1a');
    alertEl.style.background = type==='ok'? '#0f1d18' : (type==='err'? '#1a1010' : '#181409');
  }
  function clearAlert(){ alertEl.style.display='none'; alertEl.textContent=''; }

  function burstConfetti(){
    const root = $('#confetti');
    const EMO = ['🎉','🎊','✨','💫','🌟'];
    for(let i=0;i<40;i++){
      const s = document.createElement('span');
      s.textContent = EMO[(Math.random()*EMO.length)|0];
      s.style.left = (Math.random()*100)+'%';
      s.style.animationDelay = (Math.random()*0.6)+'s';
      s.style.fontSize = (16 + Math.random()*22)+'px';
      root.appendChild(s);
      setTimeout(()=> s.remove(), 2400);
    }
  }

  // --- Events ---
  $('#btnDraw').addEventListener('click', draw);
  $('#btnShuffle').addEventListener('click', reshuffle);
  $('#btnClear').addEventListener('click', ()=>{ namesEl.value=''; seedEl.value=''; saveLS(); parseNames(); teamsEl.innerHTML=''; benchEl.textContent=''; benchWrapEl.style.display='none'; clearAlert(); });
  $('#btnCopy').addEventListener('click', copyResult);
  $('#btnCSV').addEventListener('click', downloadCSV);
  $('#btnSample').addEventListener('click', ()=>{
    const demo = '홍길동, 김영희, 이철수, 박민수, 최수정, 오세훈, 유하늘, 문태양, 신별, 이빛나, 강지우, 장서윤, 노건우, 김도윤, 한지민, 윤예진, 조아라, 서한결, 표승현, 정채린, 오지후, 배하린';
    namesEl.value = demo; saveLS(); parseNames();
  });
  document.addEventListener('keydown', (e)=>{ if((e.metaKey||e.ctrlKey) && e.key==='Enter'){ e.preventDefault(); draw(); } });

  // Initial stats
  parseNames();
})();
</script>
</body>
</html>
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>제15회 SNUPOOL배 대학부 수영대회 이벤트게임 · 4:4 랜덤 판다리기</title>
  <meta name="description" content="참가자 명단을 넣으면 팀당 4명씩, 총 16명을 랜덤으로 추첨하여 물개/수달/돌고래/카피바라 팀으로 배정합니다. 모든 처리는 브라우저에서만 이뤄집니다." />
  <style>
    :root{
      --bg:#0b0b10; --panel:#15151d; --muted:#9aa1af; --text:#f2f4f8; --brand:#60a5fa; --accent:#22d3ee;
      --ok:#34d399; --warn:#fbbf24; --err:#f87171; --ring:rgba(96,165,250,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; background:linear-gradient(180deg,#0b0b10,#0f1016 40%,#0b0b10); color:var(--text); font-size:clamp(18px,1.6vw,22px)}
    .wrap{max-width:1200px; margin:0 auto; padding:32px 22px 90px}
    header h1{margin:.2rem 0 0; font-size:clamp(2.4rem,5.2vw,3.6rem); letter-spacing:.2px}
    header p{margin:.25rem 0 0; color:var(--muted); font-size:clamp(1rem,1.8vw,1.3rem)}
    header .badge{display:inline-flex; gap:.5rem; align-items:center; margin-top:.8rem; padding:.35rem .8rem; border:1px solid #273045; background:#0f1423; border-radius:999px; font-size:clamp(1rem,1.6vw,1.2rem); color:#c9d5ff}

    .grid{display:grid; gap:22px; grid-template-columns:1.1fr .9fr}
    @media(max-width:1024px){ .grid{grid-template-columns:1fr} }

    .card{background:linear-gradient(180deg,#13141c,#0f1016); border:1px solid #222536; border-radius:22px; box-shadow:0 6px 20px rgba(0,0,0,.35); overflow:hidden}
    .card .head{display:flex; align-items:center; justify-content:space-between; padding:18px 20px; border-bottom:1px solid #1e2232; background:radial-gradient(1200px 300px at -50% -100%, rgba(96,165,250,.12), transparent 50%) }
    .card .head h3{margin:0; font-weight:800; font-size:clamp(1.4rem,2.4vw,1.8rem)}
    .card .body{padding:20px}

    textarea{width:100%; min-height:280px; resize:vertical; padding:16px 16px 40px; border-radius:16px; border:1px solid #262b3d; outline:none; background:#0e111a; color:var(--text); line-height:1.6; font-size:clamp(1.2rem,2vw,1.4rem)}
    textarea:focus{border-color:#2d6eea; box-shadow:0 0 0 6px var(--ring)}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
    .hint{font-size:clamp(1rem,1.6vw,1.2rem); color:var(--muted)}

    .btn{appearance:none; border:1px solid #273045; background:linear-gradient(180deg,#1b2132,#111522); color:#e8eefc; padding:14px 18px; border-radius:14px; cursor:pointer; font-weight:800; transition:.2s transform,.2s opacity,.2s border-color; font-size:clamp(1.1rem,1.8vw,1.3rem)}
    .btn:focus{outline:none; box-shadow:0 0 0 6px var(--ring)}
    .btn:hover{transform:translateY(-1px); border-color:#334063}
    .btn[disabled]{opacity:.5; cursor:not-allowed}
    .btn.primary{border-color:#3b5ccc; background:linear-gradient(180deg,#3056c7,#2043a8)}
    .btn.ghost{background:transparent}
    .btn.success{background:linear-gradient(180deg,#16a34a,#15803d); border-color:#1a6b3d}

    .opt{display:flex; gap:12px; align-items:center}
    .opt input[type="text"]{height:44px; padding:0 12px; border-radius:12px; border:1px solid #262b3d; background:#0e111a; color:var(--text); font-size:clamp(1.1rem,1.6vw,1.2rem)}

    .teams{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
    @media(max-width:900px){ .teams{grid-template-columns:1fr} }
    .team{border:1px solid #24273a; border-radius:18px; background:linear-gradient(180deg,#141721,#101320)}
    .team .th{display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid #202335}
    .team .th h4{margin:0; font-size:clamp(1.6rem,2.8vw,2.2rem)}
    .team .th .emoji{font-size:clamp(1.6rem,2.8vw,2.2rem)}
    .team ol{margin:0; padding:16px 24px 22px 34px}
    .team ol li{margin:.4rem 0; padding:.18rem 0; font-size:clamp(1.8rem,3.4vw,2.6rem); font-weight:900; letter-spacing:.2px}

    .muted{color:var(--muted)}
    .stat{display:flex; gap:12px; flex-wrap:wrap}
    .pill{border:1px solid #273045; border-radius:999px; padding:.35rem .8rem; font-size:clamp(1rem,1.6vw,1.2rem); color:#cbd5e1}

    .footer{margin-top:18px; display:flex; gap:12px; flex-wrap:wrap}

    .alert{margin-top:12px; padding:12px 14px; border:1px solid #3a2a2a; background:#1a1010; color:#ffd1d1; border-radius:14px; font-size:clamp(1rem,1.6vw,1.2rem)}

    .confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden}
    .confetti span{position:absolute; top:-10px; font-size:18px; animation:drop 2.2s linear forwards; opacity:.95}
    @keyframes drop{to{transform:translateY(105vh) rotate(540deg); opacity:.9}}

    .small{font-size:clamp(1rem,1.6vw,1.2rem)}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; border:1px solid #2a2f45; background:#101428; padding:.12rem .5rem; border-radius:6px}

    .ghostline{border-top:1px dashed #2a2f45; margin:14px 0}
  </style>
</head>
<body>
  <div class="confetti" id="confetti" aria-hidden="true"></div>
  <div class="wrap">
    <header>
      <div class="badge">제15회 SNUPOOL배 대학부 수영대회 · 이벤트 게임</div>
      <h1>4:4 랜덤 판다리기</h1>
      <p class="small">참가자 텍스트를 붙여넣고 <span class="kbd">추첨</span>을 누르면 물개/수달/돌고래/카피바라 팀으로 4명씩, 총 16명을 자동 배정합니다. 모든 처리는 브라우저에서만 이뤄집니다.</p>
    </header>

    <div class="grid" role="main">
      <section class="card" aria-labelledby="input-head">
        <div class="head"><h3 id="input-head">참가자 입력</h3>
          <div class="row">
            <button class="btn ghost small" id="btnSample" type="button">예시 불러오기</button>
          </div>
        </div>
        <div class="body">
          <label for="names" class="hint">쉼표(,) 또는 줄바꿈으로 구분 · 공백/중복 자동 정리</label>
          <textarea id="names" placeholder="예) 홍길동, 김영희, 이철수, ..."></textarea>
          <div class="ghostline"></div>
          <div class="row" style="justify-content:space-between">
            <div class="stat">
              <span class="pill" id="statTotal">총 입력 0명</span>
              <span class="pill" id="statUnique">중복 제거 후 0명</span>
              <span class="pill" id="statDup" title="중복으로 제거된 수">중복 0명</span>
            </div>
            <div class="opt">
              <label class="small" for="seed">시드(선택):</label>
              <input type="text" id="seed" placeholder="같은 시드 = 같은 결과" />
              <label class="small" style="display:flex; gap:6px; align-items:center">
                <input type="checkbox" id="dedupe" checked /> 중복 제거
              </label>
            </div>
          </div>
          <div class="footer">
            <button class="btn primary" id="btnDraw" type="button">🎲 랜덤 추첨 (16명 선발)</button>
            <button class="btn" id="btnShuffle" type="button">🔁 다시 섞기</button>
            <button class="btn ghost" id="btnClear" type="button">🧹 초기화</button>
          </div>
          <div id="alert" class="alert" style="display:none"></div>
        </div>
      </section>

      <section class="card" aria-labelledby="result-head">
        <div class="head"><h3 id="result-head">결과</h3>
          <div class="row">
            <button class="btn small" id="btnCopy" type="button">📋 결과 복사</button>
            <button class="btn small" id="btnCSV" type="button">⬇️ CSV 다운로드</button>
          </div>
        </div>
        <div class="body">
          <div class="teams" id="teams"></div>
          <div id="benchWrap" style="margin-top:10px; display:none">
            <div class="ghostline"></div>
            <p class="muted small" id="benchTitle">미선발 명단 (0명)</p>
            <div id="bench" class="small"></div>
          </div>
        </div>
      </section>
    </div>

    <footer style="margin-top:22px; color:var(--muted)" class="small">
      팁: <span class="kbd">Cmd/Ctrl + Enter</span> 로 즉시 추첨 · 입력 내용은 로컬에 자동 저장됩니다.
    </footer>
  </div>

<script>
(function(){
  const $ = sel => document.querySelector(sel);
  const namesEl = $('#names');
  const dedupeEl = $('#dedupe');
  const seedEl = $('#seed');
  const alertEl = $('#alert');
  const teamsEl = $('#teams');
  const benchEl = $('#bench');
  const benchWrapEl = $('#benchWrap');
  const statTotal = $('#statTotal');
  const statUnique = $('#statUnique');
  const statDup = $('#statDup');
  const TEAM_INFO = [
    { key:'물개', emoji:'🦭' },
    { key:'수달', emoji:'🦦' },
    { key:'돌고래', emoji:'🐬' },
    { key:'카피바라', emoji:'🐹' }, // 카피바라 이모지 부재로 대체
  ];

  // --- LocalStorage hydration ---
  const LS_KEY = 'snupool_random_pandarigi_v1';
  try{ const saved = JSON.parse(localStorage.getItem(LS_KEY)||'null'); if(saved && saved.text){ namesEl.value = saved.text; seedEl.value = saved.seed||''; dedupeEl.checked = !!saved.dedupe; } }catch(e){}

  // --- Utility: seeded RNG (xmur3 + mulberry32) ---
  function xmur3(str){ let h=1779033703 ^ str.length; for(let i=0;i<str.length;i++){ h = Math.imul(h ^ str.charCodeAt(i), 3432918353); h = (h<<13) | (h>>>19); } return function(){ h = Math.imul(h ^ (h>>>16), 2246822507); h = Math.imul(h ^ (h>>>13), 3266489909); return (h ^= h>>>16)>>>0; } }
  function mulberry32(a){ return function(){ let t = a += 0x6D2B79F5; t = Math.imul(t ^ (t>>>15), t | 1); t ^= t + Math.imul(t ^ (t>>>7), t | 61); return ((t ^ (t>>>14)) >>> 0) / 4294967296; } }
  function rngFromSeed(seed){ if(!seed) return Math.random; const seedFn = xmur3(String(seed)); const r = mulberry32(seedFn()); return r; }

  // --- Parse input ---
  function parseNames(){
    const raw = namesEl.value.replace(/
/g, ',');
    const arr = raw.split(',').map(s=>s.trim()).filter(Boolean);
    const total = arr.length;
    let unique = arr;
    let dups = 0;
    if(dedupeEl.checked){
      const seen = new Set();
      unique = [];
      for(const n of arr){ if(!seen.has(n)){ unique.push(n); seen.add(n); } else { dups++; } }
    }
    statTotal.textContent = `총 입력 ${total}명`;
    statUnique.textContent = `중복 제거 후 ${unique.length}명`;
    statDup.textContent = `중복 ${dups}명`;
    return unique;
  }

  function saveLS(){
    try{ localStorage.setItem(LS_KEY, JSON.stringify({ text:namesEl.value, seed:seedEl.value, dedupe:dedupeEl.checked })); }catch(e){}
  }

  namesEl.addEventListener('input', ()=>{ parseNames(); saveLS(); });
  dedupeEl.addEventListener('change', ()=>{ parseNames(); saveLS(); });
  seedEl.addEventListener('input', saveLS);

  // --- Shuffle & pick ---
  function shuffleInPlace(a, rnd){ for(let i=a.length-1;i>0;i--){ const j = Math.floor(rnd()* (i+1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

  function draw(){
    clearAlert();
    const list = parseNames();
    if(list.length < 16){
      showAlert(`참가자가 ${list.length}명입니다. 최소 16명이 필요합니다.`, 'err');
      renderTeams([]); renderBench([]); return;
    }
    const rnd = rngFromSeed(seedEl.value.trim());
    const pool = list.slice();
    shuffleInPlace(pool, rnd);
    const selected = pool.slice(0, 16);
    const bench = pool.slice(16);
    renderTeams(selected);
    renderBench(bench);
    burstConfetti();
  }

  function reshuffle(){
    const hasResult = teamsEl.children.length > 0;
    if(!hasResult){ draw(); return; }
    const current = collectCurrentMembers();
    if(current.length !== 16){ draw(); return; }
    const rnd = rngFromSeed(seedEl.value.trim());
    shuffleInPlace(current, rnd);
    renderTeams(current);
    burstConfetti();
  }

  function collectCurrentMembers(){
    const li = teamsEl.querySelectorAll('li');
    return Array.from(li).map(x=>x.textContent.trim()).filter(Boolean);
  }

  function renderTeams(selected){
    teamsEl.innerHTML = '';
    if(selected.length === 0){ return; }
    const teams = [ selected.slice(0,4), selected.slice(4,8), selected.slice(8,12), selected.slice(12,16) ];
    teams.forEach((members, idx)=>{
      const info = TEAM_INFO[idx];
      const box = document.createElement('div'); box.className = 'team';
      const head = document.createElement('div'); head.className = 'th';
      head.innerHTML = `<h4><span class="emoji">${info.emoji}</span> ${info.key} 팀</h4><span class="muted small">${members.length}명</span>`;
      const list = document.createElement('ol');
      members.forEach(n=>{ const li = document.createElement('li'); li.textContent = n; list.appendChild(li); });
      box.appendChild(head); box.appendChild(list); teamsEl.appendChild(box);
    });
  }

  function renderBench(bench){
    if(!bench || bench.length===0){ benchWrapEl.style.display='none'; benchEl.textContent=''; return; }
    benchWrapEl.style.display='block';
    $('#benchTitle').textContent = `미선발 명단 (${bench.length}명)`;
    benchEl.textContent = bench.join(', ');
  }

  function toText(){
    if(teamsEl.children.length===0) return '';
    let out = `제15회 SNUPOOL배 이벤트게임 - 4:4 랜덤 판다리기
`;
    for(let i=0;i<4;i++){
      const info = TEAM_INFO[i];
      const items = teamsEl.children[i].querySelectorAll('li');
      const names = Array.from(items).map(li=>li.textContent.trim());
      out += `
[${info.emoji} ${info.key}] ${names.join(', ')}`;
    }
    if(benchEl.textContent.trim()) out += `

(미선발) ${benchEl.textContent.trim()}`;
    return out;
  }

  function toCSV(){
    const rows = [["Team","Member"]];
    for(let i=0;i<4;i++){
      const info = TEAM_INFO[i];
      const items = teamsEl.children[i]?.querySelectorAll('li') || [];
      Array.from(items).forEach(li=> rows.push([info.key, li.textContent.trim()]));
    }
    return rows.map(r=> r.map(s=> '"'+String(s).replace(/"/g,'""')+'"').join(',')).join('
');
  }

  function copyResult(){
    const txt = toText();
    if(!txt){ showAlert('복사할 결과가 없습니다. 먼저 추첨을 진행하세요.','warn'); return; }
    navigator.clipboard.writeText(txt).then(()=>{ showAlert('결과를 클립보드에 복사했어요. 원하는 곳에 붙여넣기 하세요.','ok'); });
  }

  function downloadCSV(){
    if(teamsEl.children.length===0){ showAlert('다운로드할 결과가 없습니다. 먼저 추첨을 진행하세요.','warn'); return; }
    const blob = new Blob(["﻿" + toCSV()], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'snupool_random_teams.csv';
    document.body.appendChild(a); a.click(); a.remove();
  }

  function showAlert(msg, type='warn'){
    alertEl.textContent = msg; alertEl.style.display='block';
    alertEl.style.borderColor = type==='ok'? '#1e3b2d' : (type==='err'? '#3a2a2a' : '#3a2f1a');
    alertEl.style.background = type==='ok'? '#0f1d18' : (type==='err'? '#1a1010' : '#181409');
  }
  function clearAlert(){ alertEl.style.display='none'; alertEl.textContent=''; }

  function burstConfetti(){
    const root = $('#confetti');
    const EMO = ['🎉','🎊','✨','💫','🌟'];
    for(let i=0;i<40;i++){
      const s = document.createElement('span');
      s.textContent = EMO[(Math.random()*EMO.length)|0];
      s.style.left = (Math.random()*100)+'%';
      s.style.animationDelay = (Math.random()*0.6)+'s';
      s.style.fontSize = (16 + Math.random()*22)+'px';
      root.appendChild(s);
      setTimeout(()=> s.remove(), 2400);
    }
  }

  // --- Events ---
  $('#btnDraw').addEventListener('click', draw);
  $('#btnShuffle').addEventListener('click', reshuffle);
  $('#btnClear').addEventListener('click', ()=>{ namesEl.value=''; seedEl.value=''; saveLS(); parseNames(); teamsEl.innerHTML=''; benchEl.textContent=''; benchWrapEl.style.display='none'; clearAlert(); });
  $('#btnCopy').addEventListener('click', copyResult);
  $('#btnCSV').addEventListener('click', downloadCSV);
  $('#btnSample').addEventListener('click', ()=>{
    const demo = '홍길동, 김영희, 이철수, 박민수, 최수정, 오세훈, 유하늘, 문태양, 신별, 이빛나, 강지우, 장서윤, 노건우, 김도윤, 한지민, 윤예진, 조아라, 서한결, 표승현, 정채린, 오지후, 배하린';
    namesEl.value = demo; saveLS(); parseNames();
  });
  document.addEventListener('keydown', (e)=>{ if((e.metaKey||e.ctrlKey) && e.key==='Enter'){ e.preventDefault(); draw(); } });

  // Initial stats
  parseNames();
})();
</script>
</body>
</html>
