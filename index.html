<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>제15회 SNUPOOL배 대학부 수영대회 이벤트게임 · 4:4 랜덤 판다리기</title>
  <meta name="description" content="전체화면으로 즐기는 실시간 랜덤 팀 배정: 물개/수달/돌고래/카피바라. 팝업으로 참가자 입력, 추첨 애니메이션, 결원 교체까지 지원." />
  <style>
    :root{
      --bg:#0a0b12; --panel:#111423; --panel2:#151a2d; --muted:#a7b0c3; --text:#eef2ff; --accent:#60a5fa; --accent2:#22d3ee; --ring:rgba(96,165,250,.35);
      --ok:#34d399; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:radial-gradient(1200px 600px at 10% -10%, #0f1730 0%, #0a0b12 45%, #090a11 100%); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;}

    /* ✅ GitHub Pages 중복 렌더링 가드: 첫 번째 인스턴스만 표시 */
    body > .wrap:not(:first-of-type),
    body > #confetti:not(:first-of-type),
    body > .modal:not(:first-of-type),
    body > .drawStage:not(:first-of-type){ display:none !important; }

    .wrap{max-width:1280px; margin:0 auto; padding:22px 18px 80px}

    header{display:flex; align-items:center; gap:18px; flex-wrap:wrap}
    header .title{flex:1 1 auto}
    h1{margin:.2rem 0 0; font-size:clamp(1.8rem,4.8vw,2.8rem)}
    .sub{color:#c7d2fe; font-weight:600; letter-spacing:.2px}
    .muted{color:var(--muted)}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap}

    .btn{appearance:none; border:1px solid #2a3557; background:linear-gradient(180deg,#1a2140,#121833); color:#eaf0ff; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800; letter-spacing:.2px; transition:.18s transform,.18s opacity,.18s background; font-size:clamp(1rem,1.6vw,1.2rem)}
    .btn:hover{transform:translateY(-1px)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .btn.primary{background:linear-gradient(180deg,#3157d3,#2345b3)}
    .btn.ghost{background:transparent}
    .btn.warn{background:linear-gradient(180deg,#8a5a09,#6a4307); border-color:#6a4307}

    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:16px; margin-top:14px}
    @media(max-width:980px){ .grid{grid-template-columns:1fr} }

    .card{border:1px solid #1f2745; background:linear-gradient(180deg,#131a34,#0f152b); border-radius:18px; overflow:hidden; box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .card .head{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #1b2342; background:radial-gradient(1200px 300px at -50% -80%, rgba(96,165,250,.12), transparent 60%)}
    .card .head h3{margin:0; font-size:1rem}
    .card .body{padding:16px}

    .teams{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
    @media(max-width:980px){ .teams{grid-template-columns:1fr} }
    .team{border:1px solid #242c54; border-radius:16px; background:linear-gradient(180deg,#141a36,#12162d); cursor:pointer; transition:.2s transform,.2s border-color}
    .team:hover{transform:translateY(-2px); border-color:#334072}
    .team .th{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px dashed #212a4e}
    .team .th h4{margin:0; font-size:clamp(1.4rem,2.6vw,2rem)}
    .team .count{color:#cbd5e1; font-size:clamp(1rem,1.4vw,1.2rem)}
    .chips{display:flex; gap:8px; flex-wrap:wrap; padding:12px 14px}
    .chip{border:1px solid #2a3557; background:#0e1430; padding:.35rem .65rem; border-radius:999px; font-size:clamp(1.2rem,2.2vw,1.6rem)}
    .emptyChip{opacity:.6}

    .statbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .pill{border:1px solid #2a3557; border-radius:999px; padding:.3rem .7rem; font-size:.92rem; color:#dbeafe}

    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#10213a; border:1px solid #274165; padding:10px 14px; border-radius:10px; color:#dbeafe; z-index:60; box-shadow:0 8px 24px rgba(0,0,0,.35); display:none}

    /* --- Modals (input/team/draw) --- */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50}
    .modal.show{display:flex}
    .backdrop{position:absolute; inset:0; background:rgba(5,8,20,.7); backdrop-filter:blur(2px)}
    .sheet{position:relative; width:min(920px,92vw); max-height:88vh; overflow:auto; border-radius:18px; border:1px solid #2a335a; background:linear-gradient(180deg,#121734,#0c1129); box-shadow:0 20px 80px rgba(0,0,0,.55)}

    /* Input modal */
    .sheet .hd{display:flex; align-items:center; justify-content:space-between; padding:16px; border-bottom:1px solid #1c2446}
    .sheet .hd h3{margin:0}
    .sheet .bd{padding:16px}
    textarea{width:100%; min-height:260px; resize:vertical; padding:14px; border-radius:12px; border:1px solid #273055; background:#0d1330; color:var(--text); line-height:1.5; font-size:clamp(1.1rem,1.6vw,1.3rem)}
    textarea:focus{outline:none; box-shadow:0 0 0 4px var(--ring)}

    /* Team modal */
    .biglist{padding:18px}
    .biglist h2{margin:.3rem 0 12px; font-size:clamp(1.6rem,4vw,2.2rem)}
    .bigrow{display:flex; align-items:center; justify-content:space-between; gap:12px; border:1px solid #263161; background:linear-gradient(180deg,#141b3f,#10163a); border-radius:14px; padding:16px; margin:12px 0}
    .bigname{font-size:clamp(2.2rem,6.2vw,4.4rem); font-weight:900; letter-spacing:.3px}
    .bigrow .actions{display:flex; gap:8px; align-items:center}
    .xbtn{appearance:none; border:1px solid #3a2540; background:linear-gradient(180deg,#401a25,#2a1016); color:#ffd7d7; padding:.5rem .8rem; border-radius:10px; cursor:pointer; font-weight:900; font-size:clamp(1rem,1.4vw,1.2rem)}
    .fillbtn{appearance:none; border:1px solid #244a3a; background:linear-gradient(180deg,#135f43,#0e4a34); color:#d1fae5; padding:.6rem .9rem; border-radius:10px; cursor:pointer; font-weight:900; font-size:clamp(1rem,1.4vw,1.2rem)}

    /* Draw overlay */
    .drawStage{position:fixed; inset:0; display:none; place-items:center; background:radial-gradient(1000px 400px at 50% -10%, rgba(34,211,238,.12), transparent 50%), radial-gradient(1200px 500px at 20% 120%, rgba(96,165,250,.15), transparent 60%), #070a14; z-index:70}
    .drawStage.show{display:grid}
    .drawInner{text-align:center}
    .drawTitle{font-size:clamp(1.8rem,4.2vw,2.6rem); margin:0 0 14px}
    .ticker{font-size:clamp(2.6rem,7.2vw,5rem); font-weight:900; letter-spacing:.6px}
    .ticker span{display:inline-block; animation:pop .15s ease}
    @keyframes pop{0%{transform:scale(1)} 50%{transform:scale(1.06)} 100%{transform:scale(1)}}

    .confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden}
    .confetti span{position:absolute; top:-10px; font-size:16px; animation:drop 2.2s linear forwards; opacity:.95}
    @keyframes drop{to{transform:translateY(105vh) rotate(540deg); opacity:.9}}

    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; border:1px solid #2a2f45; background:#101428; padding:.08rem .4rem; border-radius:6px}
  </style>
</head>
<body>
  <div class="confetti" id="confetti" aria-hidden="true"></div>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="sub">제15회 SNUPOOL배 대학부 수영대회 · 이벤트 게임</div>
        <h1>4:4 랜덤 판다리기</h1>
        <div class="muted" style="margin-top:4px">전체 화면으로 띄우고 진행하세요. 오른쪽 상단 버튼으로 참가자 입력/추첨을 제어합니다.</div>
      </div>
      <div class="toolbar">
        <button class="btn" id="btnFullscreen" type="button">⛶ 전체화면</button>
        <button class="btn" id="btnOpenInput" type="button">✍️ 참가자 입력</button>
        <button class="btn primary" id="btnStartDraw" type="button">🎲 추첨 시작</button>
        <button class="btn ghost" id="btnRedraw" type="button" disabled>🔁 다시 추첨</button>
      </div>
    </header>

    <section class="card" style="margin-top:12px">
      <div class="head"><h3>팀 현황</h3>
        <div class="statbar">
          <span class="pill" id="statTotal">총 참가자 0명</span>
          <span class="pill" id="statUnique">중복 제거 후 0명</span>
          <span class="pill" id="statBench">미선발 0명</span>
        </div>
      </div>
      <div class="body">
        <div class="teams" id="teams"></div>
      </div>
    </section>

    <div class="toast" id="toast"></div>
  </div>

  <!-- 참가자 입력 모달 -->
  <div class="modal" id="inputModal" role="dialog" aria-modal="true">
    <div class="backdrop" data-close="input"></div>
    <div class="sheet" role="document">
      <div class="hd">
        <h3>참가자 입력</h3>
        <div class="muted">쉼표(,) 또는 줄바꿈으로 구분 · 중복 자동 제거</div>
      </div>
      <div class="bd">
        <textarea id="names" placeholder="예) 홍길동, 김영희, 이철수, ..."></textarea>
        <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:10px">
          <div class="muted">Tip: <span class="kbd">Cmd/Ctrl + Enter</span> 저장</div>
          <div>
            <button class="btn ghost" id="btnSample" type="button">예시 불러오기</button>
            <button class="btn" id="btnSaveNames" type="button">저장</button>
            <button class="btn warn" id="btnCloseInput" type="button">닫기</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 팀 상세 모달 -->
  <div class="modal" id="teamModal" role="dialog" aria-modal="true">
    <div class="backdrop" data-close="team"></div>
    <div class="sheet" role="document" style="width:min(1000px,94vw)">
      <div class="hd">
        <h3 id="teamTitle">팀 상세</h3>
        <div>
          <button class="btn warn" id="btnCloseTeam" type="button">닫기</button>
        </div>
      </div>
      <div class="biglist" id="teamList"></div>
    </div>
  </div>

  <!-- 추첨 애니메이션 오버레이 -->
  <div class="drawStage" id="drawStage">
    <div class="drawInner">
      <h2 class="drawTitle">추첨중… 잠시만요!</h2>
      <div class="ticker" id="ticker">시작합니다</div>
    </div>
  </div>

<script>
(function(){
  // ✅ 두겹 렌더링 방지: 이미 초기화되었다면 재실행하지 않음
  if(window.__SNUPOOL_444_INIT__){ return; }
  window.__SNUPOOL_444_INIT__ = true;

  // ✅ DOM에 중복 인스턴스가 있으면 첫 것만 남기고 삭제 (테마/중첩 방지)
  (function dedupe(){
    const keepFirst = (sel)=>{ const nodes = document.querySelectorAll(sel); for(let i=1;i<nodes.length;i++){ nodes[i].remove(); } };
    keepFirst('body > .wrap');
    ['#confetti','#inputModal','#teamModal','#drawStage'].forEach(keepFirst);
  })();

  const $ = (s,el=document)=> el.querySelector(s);
  const $$ = (s,el=document)=> Array.from(el.querySelectorAll(s));

  const TEAM_INFO = [
    {key:'물개', emoji:'🦭'},
    {key:'수달', emoji:'🦦'},
    {key:'돌고래', emoji:'🐬'},
    {key:'카피바라', emoji:'🐹'}, // 대체 이모지
  ];

  const LS_KEY = 'snupool_random_444_v2';

  // State
  const state = {
    participants: [], // unique list
    bench: [],        // not selected
    teams: [[],[],[],[]], // 4x4 names
    drawn:false
  };

  // Elements
  const teamsEl = $('#teams');
  const statTotal = $('#statTotal');
  const statUnique = $('#statUnique');
  const statBench = $('#statBench');
  const toastEl = $('#toast');

  const inputModal = $('#inputModal');
  const namesEl = $('#names');
  const teamModal = $('#teamModal');
  const teamTitle = $('#teamTitle');
  const teamList = $('#teamList');

  const drawStage = $('#drawStage');
  const ticker = $('#ticker');

  // Utils
  function showToast(msg){
    toastEl.textContent = msg; toastEl.style.display='block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toastEl.style.display='none', 2200);
  }
  function saveLS(){ try{ localStorage.setItem(LS_KEY, JSON.stringify({text:namesEl.value})); }catch(e){} }
  function loadLS(){ try{ const s = JSON.parse(localStorage.getItem(LS_KEY)||'null'); if(s && s.text){ namesEl.value = s.text; } }catch(e){} }

  function parseNames(){
    const raw = namesEl.value.replace(/
/g, ',');
    const arr = raw.split(',').map(s=> s.trim()).filter(Boolean);
    const total = arr.length;
    const uniq = [];
    const seen = new Set();
    for(const n of arr){ if(!seen.has(n)){ uniq.push(n); seen.add(n);} }
    statTotal.textContent = `총 참가자 ${total}명`;
    statUnique.textContent = `중복 제거 후 ${uniq.length}명`;
    return uniq;
  }

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j = (Math.random()*(i+1))|0; [a[i],a[j]] = [a[j],a[i]]; } return a; }

  function renderTeams(){
    teamsEl.innerHTML = '';
    TEAM_INFO.forEach((info, idx)=>{
      const box = document.createElement('div'); box.className='team'; box.dataset.idx = idx;
      const head = document.createElement('div'); head.className='th';
      const count = state.teams[idx].filter(Boolean).length;
      head.innerHTML = `<h4><span style=\"margin-right:8px\">${info.emoji}</span>${info.key} 팀</h4><div class=\"count\">${count}/4</div>`;
      const chips = document.createElement('div'); chips.className='chips';
      // Small preview chips (names or empty slots)
      for(let i=0;i<4;i++){
        const name = state.teams[idx][i];
        const span = document.createElement('span');
        span.className = 'chip' + (name?'' : ' emptyChip');
        span.textContent = name || '빈 자리';
        chips.appendChild(span);
      }
      box.appendChild(head); box.appendChild(chips);
      box.addEventListener('click', ()=> openTeam(idx));
      teamsEl.appendChild(box);
    });
    statBench.textContent = `미선발 ${state.bench.length}명`;
    $('#btnRedraw').disabled = !state.drawn;
  }

  function openTeam(idx){
    teamTitle.textContent = `${TEAM_INFO[idx].emoji} ${TEAM_INFO[idx].key} 팀`;
    teamList.innerHTML = '';
    for(let i=0;i<4;i++){
      const row = document.createElement('div'); row.className='bigrow'; row.dataset.pos = i; row.dataset.team = idx;
      const name = state.teams[idx][i];
      const left = document.createElement('div');
      left.className='bigname';
      left.textContent = name || '— 빈 자리 —';
      const right = document.createElement('div'); right.className='actions';
      if(name){
        const x = document.createElement('button'); x.className='xbtn'; x.textContent='✕ 제거';
        x.addEventListener('click', ()=> removeMember(idx,i));
        right.appendChild(x);
      } else {
        const f = document.createElement('button'); f.className='fillbtn'; f.textContent='새 선수 뽑기';
        f.addEventListener('click', ()=> fillVacancy(idx,i, f));
        right.appendChild(f);
      }
      row.appendChild(left); row.appendChild(right);
      teamList.appendChild(row);
    }
    teamModal.classList.add('show');
  }
  function closeTeam(){ teamModal.classList.remove('show'); }

  function removeMember(tIdx, pos){
    const name = state.teams[tIdx][pos];
    if(!name) return;
    // move back to bench
    state.bench.push(name);
    state.teams[tIdx][pos] = null;
    showToast(`${TEAM_INFO[tIdx].key} 팀: ${name} → 미선발로 이동`);
    renderTeams();
    openTeam(tIdx); // re-render
  }

  function fillVacancy(tIdx, pos, btnEl){
    if(state.bench.length===0){ showToast('미선발 인원이 없습니다.'); return; }
    // simple slot-machine effect on the button
    const orig = btnEl.textContent;
    let i=0; const id = setInterval(()=>{ btnEl.textContent = state.bench[(Math.random()*state.bench.length)|0] || '추첨 중…'; }, 90);
    btnEl.disabled = true;
    setTimeout(()=>{
      clearInterval(id);
      // pick final
      const pickIdx = (Math.random()*state.bench.length)|0;
      const pick = state.bench.splice(pickIdx,1)[0];
      state.teams[tIdx][pos] = pick;
      renderTeams();
      openTeam(tIdx);
      burstConfetti();
    }, 1100);
  }

  // Draw flow
  function startDraw(){
    const uniq = parseNames();
    if(uniq.length < 16){ showToast('최소 16명이 필요합니다. 참가자를 더 입력하세요.'); openInput(); return; }
    state.participants = uniq.slice();
    drawStage.classList.add('show');
    runTicker(uniq);
    setTimeout(()=> finalizeDraw(), 2600);
  }

  function finalizeDraw(){
    drawStage.classList.remove('show');
    const pool = shuffle(state.participants.slice());
    const selected = pool.slice(0,16);
    state.bench = pool.slice(16);
    // distribute
    state.teams = [[],[],[],[]];
    for(let i=0;i<16;i++) state.teams[i>>2].push(selected[i]);
    state.drawn = true;
    renderTeams();
    burstConfetti();
  }

  function runTicker(list){
    let count = 0;
    const id = setInterval(()=>{
      const name = list[(Math.random()*list.length)|0] || '—';
      ticker.innerHTML = `<span>${name}</span>`;
      count++;
      if(count>=24){ clearInterval(id); }
    }, 90);
  }

  function resetDraw(){
    if(!state.participants.length){ showToast('먼저 참가자를 입력하세요.'); return; }
    state.teams = [[],[],[],[]];
    state.bench = [];
    state.drawn = false;
    renderTeams();
    startDraw();
  }

  function burstConfetti(){
    const root = $('#confetti');
    const EMO = ['🎉','🎊','✨','💫','🌟'];
    for(let i=0;i<45;i++){
      const s = document.createElement('span');
      s.textContent = EMO[(Math.random()*EMO.length)|0];
      s.style.left = (Math.random()*100)+'%';
      s.style.animationDelay = (Math.random()*0.6)+'s';
      s.style.fontSize = (12 + Math.random()*18)+'px';
      root.appendChild(s);
      setTimeout(()=> s.remove(), 2400);
    }
  }

  // Input modal controls
  function openInput(){ inputModal.classList.add('show'); }
  function closeInput(){ inputModal.classList.remove('show'); }

  // Events
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('button'); if(!t) return;
    const id = t.id;
    if(id==='btnOpenInput') return openInput();
    if(id==='btnCloseInput'){ closeInput(); return; }
    if(id==='btnSaveNames'){ saveLS(); const u=parseNames(); showToast(`${u.length}명 저장됨`); renderTeams(); return; }
    if(id==='btnSample'){ const demo='홍길동, 김영희, 이철수, 박민수, 최수정, 오세훈, 유하늘, 문태양, 신별, 이빛나, 강지우, 장서윤, 노건우, 김도윤, 한지민, 윤예진, 조아라, 서한결, 표승현, 정채린, 오지후, 배하린, 박찬수, 최다연, 김하늘, 우민서, 정가온, 박도현, 김태희, 송하준, 이가람, 홍서윤'; namesEl.value=demo; saveLS(); const u=parseNames(); showToast(`${u.length}명 샘플 입력`); return; }
    if(id==='btnCloseTeam') return closeTeam();
    if(id==='btnStartDraw') return startDraw();
    if(id==='btnRedraw') return resetDraw();
    if(id==='btnFullscreen'){
      (async()=>{ try{ if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); } else{ await document.exitFullscreen(); } }catch(e){ showToast('브라우저가 전체화면을 허용하지 않았습니다. F11 키를 사용하세요.'); } })();
      return;
    }
  });

  namesEl.addEventListener('input', saveLS);
  namesEl.addEventListener('keydown', (e)=>{ if((e.metaKey||e.ctrlKey) && e.key==='Enter'){ e.preventDefault(); const b=$('#btnSaveNames'); if(b) b.click(); } });

  // Initial
  loadLS();
  const u = parseNames();
  showToast(`${u.length}명 불러옴`);
  renderTeams();
})();
</script>
</body>
</html>
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>제15회 SNUPOOL배 대학부 수영대회 이벤트게임 · 4:4 랜덤 판다리기</title>
  <meta name="description" content="전체화면으로 즐기는 실시간 랜덤 팀 배정: 물개/수달/돌고래/카피바라. 팝업으로 참가자 입력, 추첨 애니메이션, 결원 교체까지 지원." />
  <style>
    :root{
      --bg:#0a0b12; --panel:#111423; --panel2:#151a2d; --muted:#a7b0c3; --text:#eef2ff; --accent:#60a5fa; --accent2:#22d3ee; --ring:rgba(96,165,250,.35);
      --ok:#34d399; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:radial-gradient(1200px 600px at 10% -10%, #0f1730 0%, #0a0b12 45%, #090a11 100%); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;}

    /* ✅ GitHub Pages 중복 렌더링 가드: 첫 번째 인스턴스만 표시 */
    body > .wrap:not(:first-of-type),
    body > #confetti:not(:first-of-type),
    body > .modal:not(:first-of-type),
    body > .drawStage:not(:first-of-type){ display:none !important; }

    .wrap{max-width:1280px; margin:0 auto; padding:22px 18px 80px}

    header{display:flex; align-items:center; gap:18px; flex-wrap:wrap}
    header .title{flex:1 1 auto}
    h1{margin:.2rem 0 0; font-size:clamp(1.8rem,4.8vw,2.8rem)}
    .sub{color:#c7d2fe; font-weight:600; letter-spacing:.2px}
    .muted{color:var(--muted)}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap}

    .btn{appearance:none; border:1px solid #2a3557; background:linear-gradient(180deg,#1a2140,#121833); color:#eaf0ff; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800; letter-spacing:.2px; transition:.18s transform,.18s opacity,.18s background; font-size:clamp(1rem,1.6vw,1.2rem)}
    .btn:hover{transform:translateY(-1px)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .btn.primary{background:linear-gradient(180deg,#3157d3,#2345b3)}
    .btn.ghost{background:transparent}
    .btn.warn{background:linear-gradient(180deg,#8a5a09,#6a4307); border-color:#6a4307}

    .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:16px; margin-top:14px}
    @media(max-width:980px){ .grid{grid-template-columns:1fr} }

    .card{border:1px solid #1f2745; background:linear-gradient(180deg,#131a34,#0f152b); border-radius:18px; overflow:hidden; box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .card .head{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #1b2342; background:radial-gradient(1200px 300px at -50% -80%, rgba(96,165,250,.12), transparent 60%)}
    .card .head h3{margin:0; font-size:1rem}
    .card .body{padding:16px}

    .teams{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
    @media(max-width:980px){ .teams{grid-template-columns:1fr} }
    .team{border:1px solid #242c54; border-radius:16px; background:linear-gradient(180deg,#141a36,#12162d); cursor:pointer; transition:.2s transform,.2s border-color}
    .team:hover{transform:translateY(-2px); border-color:#334072}
    .team .th{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px dashed #212a4e}
    .team .th h4{margin:0; font-size:clamp(1.4rem,2.6vw,2rem)}
    .team .count{color:#cbd5e1; font-size:clamp(1rem,1.4vw,1.2rem)}
    .chips{display:flex; gap:8px; flex-wrap:wrap; padding:12px 14px}
    .chip{border:1px solid #2a3557; background:#0e1430; padding:.35rem .65rem; border-radius:999px; font-size:clamp(1.2rem,2.2vw,1.6rem)}
    .emptyChip{opacity:.6}

    .statbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .pill{border:1px solid #2a3557; border-radius:999px; padding:.3rem .7rem; font-size:.92rem; color:#dbeafe}

    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#10213a; border:1px solid #274165; padding:10px 14px; border-radius:10px; color:#dbeafe; z-index:60; box-shadow:0 8px 24px rgba(0,0,0,.35); display:none}

    /* --- Modals (input/team/draw) --- */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50}
    .modal.show{display:flex}
    .backdrop{position:absolute; inset:0; background:rgba(5,8,20,.7); backdrop-filter:blur(2px)}
    .sheet{position:relative; width:min(920px,92vw); max-height:88vh; overflow:auto; border-radius:18px; border:1px solid #2a335a; background:linear-gradient(180deg,#121734,#0c1129); box-shadow:0 20px 80px rgba(0,0,0,.55)}

    /* Input modal */
    .sheet .hd{display:flex; align-items:center; justify-content:space-between; padding:16px; border-bottom:1px solid #1c2446}
    .sheet .hd h3{margin:0}
    .sheet .bd{padding:16px}
    textarea{width:100%; min-height:260px; resize:vertical; padding:14px; border-radius:12px; border:1px solid #273055; background:#0d1330; color:var(--text); line-height:1.5; font-size:clamp(1.1rem,1.6vw,1.3rem)}
    textarea:focus{outline:none; box-shadow:0 0 0 4px var(--ring)}

    /* Team modal */
    .biglist{padding:18px}
    .biglist h2{margin:.3rem 0 12px; font-size:clamp(1.6rem,4vw,2.2rem)}
    .bigrow{display:flex; align-items:center; justify-content:space-between; gap:12px; border:1px solid #263161; background:linear-gradient(180deg,#141b3f,#10163a); border-radius:14px; padding:16px; margin:12px 0}
    .bigname{font-size:clamp(2.2rem,6.2vw,4.4rem); font-weight:900; letter-spacing:.3px}
    .bigrow .actions{display:flex; gap:8px; align-items:center}
    .xbtn{appearance:none; border:1px solid #3a2540; background:linear-gradient(180deg,#401a25,#2a1016); color:#ffd7d7; padding:.5rem .8rem; border-radius:10px; cursor:pointer; font-weight:900; font-size:clamp(1rem,1.4vw,1.2rem)}
    .fillbtn{appearance:none; border:1px solid #244a3a; background:linear-gradient(180deg,#135f43,#0e4a34); color:#d1fae5; padding:.6rem .9rem; border-radius:10px; cursor:pointer; font-weight:900; font-size:clamp(1rem,1.4vw,1.2rem)}

    /* Draw overlay */
    .drawStage{position:fixed; inset:0; display:none; place-items:center; background:radial-gradient(1000px 400px at 50% -10%, rgba(34,211,238,.12), transparent 50%), radial-gradient(1200px 500px at 20% 120%, rgba(96,165,250,.15), transparent 60%), #070a14; z-index:70}
    .drawStage.show{display:grid}
    .drawInner{text-align:center}
    .drawTitle{font-size:clamp(1.8rem,4.2vw,2.6rem); margin:0 0 14px}
    .ticker{font-size:clamp(2.6rem,7.2vw,5rem); font-weight:900; letter-spacing:.6px}
    .ticker span{display:inline-block; animation:pop .15s ease}
    @keyframes pop{0%{transform:scale(1)} 50%{transform:scale(1.06)} 100%{transform:scale(1)}}

    .confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden}
    .confetti span{position:absolute; top:-10px; font-size:16px; animation:drop 2.2s linear forwards; opacity:.95}
    @keyframes drop{to{transform:translateY(105vh) rotate(540deg); opacity:.9}}

    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; border:1px solid #2a2f45; background:#101428; padding:.08rem .4rem; border-radius:6px}
  </style>
</head>
<body>
  <div class="confetti" id="confetti" aria-hidden="true"></div>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="sub">제15회 SNUPOOL배 대학부 수영대회 · 이벤트 게임</div>
        <h1>4:4 랜덤 판다리기</h1>
        <div class="muted" style="margin-top:4px">전체 화면으로 띄우고 진행하세요. 오른쪽 상단 버튼으로 참가자 입력/추첨을 제어합니다.</div>
      </div>
      <div class="toolbar">
        <button class="btn" id="btnFullscreen" type="button">⛶ 전체화면</button>
        <button class="btn" id="btnOpenInput" type="button">✍️ 참가자 입력</button>
        <button class="btn primary" id="btnStartDraw" type="button">🎲 추첨 시작</button>
        <button class="btn ghost" id="btnRedraw" type="button" disabled>🔁 다시 추첨</button>
      </div>
    </header>

    <section class="card" style="margin-top:12px">
      <div class="head"><h3>팀 현황</h3>
        <div class="statbar">
          <span class="pill" id="statTotal">총 참가자 0명</span>
          <span class="pill" id="statUnique">중복 제거 후 0명</span>
          <span class="pill" id="statBench">미선발 0명</span>
        </div>
      </div>
      <div class="body">
        <div class="teams" id="teams"></div>
      </div>
    </section>

    <div class="toast" id="toast"></div>
  </div>

  <!-- 참가자 입력 모달 -->
  <div class="modal" id="inputModal" role="dialog" aria-modal="true">
    <div class="backdrop" data-close="input"></div>
    <div class="sheet" role="document">
      <div class="hd">
        <h3>참가자 입력</h3>
        <div class="muted">쉼표(,) 또는 줄바꿈으로 구분 · 중복 자동 제거</div>
      </div>
      <div class="bd">
        <textarea id="names" placeholder="예) 홍길동, 김영희, 이철수, ..."></textarea>
        <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:10px">
          <div class="muted">Tip: <span class="kbd">Cmd/Ctrl + Enter</span> 저장</div>
          <div>
            <button class="btn ghost" id="btnSample" type="button">예시 불러오기</button>
            <button class="btn" id="btnSaveNames" type="button">저장</button>
            <button class="btn warn" id="btnCloseInput" type="button">닫기</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 팀 상세 모달 -->
  <div class="modal" id="teamModal" role="dialog" aria-modal="true">
    <div class="backdrop" data-close="team"></div>
    <div class="sheet" role="document" style="width:min(1000px,94vw)">
      <div class="hd">
        <h3 id="teamTitle">팀 상세</h3>
        <div>
          <button class="btn warn" id="btnCloseTeam" type="button">닫기</button>
        </div>
      </div>
      <div class="biglist" id="teamList"></div>
    </div>
  </div>

  <!-- 추첨 애니메이션 오버레이 -->
  <div class="drawStage" id="drawStage">
    <div class="drawInner">
      <h2 class="drawTitle">추첨중… 잠시만요!</h2>
      <div class="ticker" id="ticker">시작합니다</div>
    </div>
  </div>

<script>
(function(){
  // ✅ 두겹 렌더링 방지: 이미 초기화되었다면 재실행하지 않음
  if(window.__SNUPOOL_444_INIT__){ return; }
  window.__SNUPOOL_444_INIT__ = true;

  // ✅ DOM에 중복 인스턴스가 있으면 첫 것만 남기고 삭제 (테마/중첩 방지)
  (function dedupe(){
    const keepFirst = (sel)=>{ const nodes = document.querySelectorAll(sel); for(let i=1;i<nodes.length;i++){ nodes[i].remove(); } };
    keepFirst('body > .wrap');
    ['#confetti','#inputModal','#teamModal','#drawStage'].forEach(keepFirst);
  })();

  const $ = (s,el=document)=> el.querySelector(s);
  const $$ = (s,el=document)=> Array.from(el.querySelectorAll(s));

  const TEAM_INFO = [
    {key:'물개', emoji:'🦭'},
    {key:'수달', emoji:'🦦'},
    {key:'돌고래', emoji:'🐬'},
    {key:'카피바라', emoji:'🐹'}, // 대체 이모지
  ];

  const LS_KEY = 'snupool_random_444_v2';

  // State
  const state = {
    participants: [], // unique list
    bench: [],        // not selected
    teams: [[],[],[],[]], // 4x4 names
    drawn:false
  };

  // Elements
  const teamsEl = $('#teams');
  const statTotal = $('#statTotal');
  const statUnique = $('#statUnique');
  const statBench = $('#statBench');
  const toastEl = $('#toast');

  const inputModal = $('#inputModal');
  const namesEl = $('#names');
  const teamModal = $('#teamModal');
  const teamTitle = $('#teamTitle');
  const teamList = $('#teamList');

  const drawStage = $('#drawStage');
  const ticker = $('#ticker');

  // Utils
  function showToast(msg){
    toastEl.textContent = msg; toastEl.style.display='block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toastEl.style.display='none', 2200);
  }
  function saveLS(){ try{ localStorage.setItem(LS_KEY, JSON.stringify({text:namesEl.value})); }catch(e){} }
  function loadLS(){ try{ const s = JSON.parse(localStorage.getItem(LS_KEY)||'null'); if(s && s.text){ namesEl.value = s.text; } }catch(e){} }

  function parseNames(){
    const raw = namesEl.value.replace(/
/g, ',');
    const arr = raw.split(',').map(s=> s.trim()).filter(Boolean);
    const total = arr.length;
    const uniq = [];
    const seen = new Set();
    for(const n of arr){ if(!seen.has(n)){ uniq.push(n); seen.add(n);} }
    statTotal.textContent = `총 참가자 ${total}명`;
    statUnique.textContent = `중복 제거 후 ${uniq.length}명`;
    return uniq;
  }

  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j = (Math.random()*(i+1))|0; [a[i],a[j]] = [a[j],a[i]]; } return a; }

  function renderTeams(){
    teamsEl.innerHTML = '';
    TEAM_INFO.forEach((info, idx)=>{
      const box = document.createElement('div'); box.className='team'; box.dataset.idx = idx;
      const head = document.createElement('div'); head.className='th';
      const count = state.teams[idx].filter(Boolean).length;
      head.innerHTML = `<h4><span style=\"margin-right:8px\">${info.emoji}</span>${info.key} 팀</h4><div class=\"count\">${count}/4</div>`;
      const chips = document.createElement('div'); chips.className='chips';
      // Small preview chips (names or empty slots)
      for(let i=0;i<4;i++){
        const name = state.teams[idx][i];
        const span = document.createElement('span');
        span.className = 'chip' + (name?'' : ' emptyChip');
        span.textContent = name || '빈 자리';
        chips.appendChild(span);
      }
      box.appendChild(head); box.appendChild(chips);
      box.addEventListener('click', ()=> openTeam(idx));
      teamsEl.appendChild(box);
    });
    statBench.textContent = `미선발 ${state.bench.length}명`;
    $('#btnRedraw').disabled = !state.drawn;
  }

  function openTeam(idx){
    teamTitle.textContent = `${TEAM_INFO[idx].emoji} ${TEAM_INFO[idx].key} 팀`;
    teamList.innerHTML = '';
    for(let i=0;i<4;i++){
      const row = document.createElement('div'); row.className='bigrow'; row.dataset.pos = i; row.dataset.team = idx;
      const name = state.teams[idx][i];
      const left = document.createElement('div');
      left.className='bigname';
      left.textContent = name || '— 빈 자리 —';
      const right = document.createElement('div'); right.className='actions';
      if(name){
        const x = document.createElement('button'); x.className='xbtn'; x.textContent='✕ 제거';
        x.addEventListener('click', ()=> removeMember(idx,i));
        right.appendChild(x);
      } else {
        const f = document.createElement('button'); f.className='fillbtn'; f.textContent='새 선수 뽑기';
        f.addEventListener('click', ()=> fillVacancy(idx,i, f));
        right.appendChild(f);
      }
      row.appendChild(left); row.appendChild(right);
      teamList.appendChild(row);
    }
    teamModal.classList.add('show');
  }
  function closeTeam(){ teamModal.classList.remove('show'); }

  function removeMember(tIdx, pos){
    const name = state.teams[tIdx][pos];
    if(!name) return;
    // move back to bench
    state.bench.push(name);
    state.teams[tIdx][pos] = null;
    showToast(`${TEAM_INFO[tIdx].key} 팀: ${name} → 미선발로 이동`);
    renderTeams();
    openTeam(tIdx); // re-render
  }

  function fillVacancy(tIdx, pos, btnEl){
    if(state.bench.length===0){ showToast('미선발 인원이 없습니다.'); return; }
    // simple slot-machine effect on the button
    const orig = btnEl.textContent;
    let i=0; const id = setInterval(()=>{ btnEl.textContent = state.bench[(Math.random()*state.bench.length)|0] || '추첨 중…'; }, 90);
    btnEl.disabled = true;
    setTimeout(()=>{
      clearInterval(id);
      // pick final
      const pickIdx = (Math.random()*state.bench.length)|0;
      const pick = state.bench.splice(pickIdx,1)[0];
      state.teams[tIdx][pos] = pick;
      renderTeams();
      openTeam(tIdx);
      burstConfetti();
    }, 1100);
  }

  // Draw flow
  function startDraw(){
    const uniq = parseNames();
    if(uniq.length < 16){ showToast('최소 16명이 필요합니다. 참가자를 더 입력하세요.'); openInput(); return; }
    state.participants = uniq.slice();
    drawStage.classList.add('show');
    runTicker(uniq);
    setTimeout(()=> finalizeDraw(), 2600);
  }

  function finalizeDraw(){
    drawStage.classList.remove('show');
    const pool = shuffle(state.participants.slice());
    const selected = pool.slice(0,16);
    state.bench = pool.slice(16);
    // distribute
    state.teams = [[],[],[],[]];
    for(let i=0;i<16;i++) state.teams[i>>2].push(selected[i]);
    state.drawn = true;
    renderTeams();
    burstConfetti();
  }

  function runTicker(list){
    let count = 0;
    const id = setInterval(()=>{
      const name = list[(Math.random()*list.length)|0] || '—';
      ticker.innerHTML = `<span>${name}</span>`;
      count++;
      if(count>=24){ clearInterval(id); }
    }, 90);
  }

  function resetDraw(){
    if(!state.participants.length){ showToast('먼저 참가자를 입력하세요.'); return; }
    state.teams = [[],[],[],[]];
    state.bench = [];
    state.drawn = false;
    renderTeams();
    startDraw();
  }

  function burstConfetti(){
    const root = $('#confetti');
    const EMO = ['🎉','🎊','✨','💫','🌟'];
    for(let i=0;i<45;i++){
      const s = document.createElement('span');
      s.textContent = EMO[(Math.random()*EMO.length)|0];
      s.style.left = (Math.random()*100)+'%';
      s.style.animationDelay = (Math.random()*0.6)+'s';
      s.style.fontSize = (12 + Math.random()*18)+'px';
      root.appendChild(s);
      setTimeout(()=> s.remove(), 2400);
    }
  }

  // Input modal controls
  function openInput(){ inputModal.classList.add('show'); }
  function closeInput(){ inputModal.classList.remove('show'); }

  // Events
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('button'); if(!t) return;
    const id = t.id;
    if(id==='btnOpenInput') return openInput();
    if(id==='btnCloseInput'){ closeInput(); return; }
    if(id==='btnSaveNames'){ saveLS(); const u=parseNames(); showToast(`${u.length}명 저장됨`); renderTeams(); return; }
    if(id==='btnSample'){ const demo='홍길동, 김영희, 이철수, 박민수, 최수정, 오세훈, 유하늘, 문태양, 신별, 이빛나, 강지우, 장서윤, 노건우, 김도윤, 한지민, 윤예진, 조아라, 서한결, 표승현, 정채린, 오지후, 배하린, 박찬수, 최다연, 김하늘, 우민서, 정가온, 박도현, 김태희, 송하준, 이가람, 홍서윤'; namesEl.value=demo; saveLS(); const u=parseNames(); showToast(`${u.length}명 샘플 입력`); return; }
    if(id==='btnCloseTeam') return closeTeam();
    if(id==='btnStartDraw') return startDraw();
    if(id==='btnRedraw') return resetDraw();
    if(id==='btnFullscreen'){
      (async()=>{ try{ if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); } else{ await document.exitFullscreen(); } }catch(e){ showToast('브라우저가 전체화면을 허용하지 않았습니다. F11 키를 사용하세요.'); } })();
      return;
    }
  });

  namesEl.addEventListener('input', saveLS);
  namesEl.addEventListener('keydown', (e)=>{ if((e.metaKey||e.ctrlKey) && e.key==='Enter'){ e.preventDefault(); const b=$('#btnSaveNames'); if(b) b.click(); } });

  // Initial
  loadLS();
  const u = parseNames();
  showToast(`${u.length}명 불러옴`);
  renderTeams();
})();
</script>
</body>
</html>
